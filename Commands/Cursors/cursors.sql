/*
    –ö—É—Ä—Å–æ—Ä—ã - —ç—Ç–æ –æ–±—ä–µ–∫—Ç –≤ SQL Server, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ—Å—Ç—Ä–æ—á–Ω–æ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞.
    
    üîª
    DECLARE ‚Äî –æ–±—ä—è–≤–ª—è–µ–º –∫—É—Ä—Å–æ—Ä –∏ —É–∫–∞–∑—ã–≤–∞–µ–º, –∫–∞–∫–æ–π SELECT –±—É–¥–µ—Ç –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –¥–∞–Ω–Ω—ã—Ö.
    OPEN ‚Äî –æ—Ç–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä (SQL –Ω–∞—á–∏–Ω–∞–µ—Ç —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å –Ω–∞–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö).
    FETCH NEXT ‚Äî –¥–æ—Å—Ç–∞—ë–º —Å—Ç—Ä–æ–∫—É (–∫—É—Ä—Å–æ—Ä –¥–≤–∏–≥–∞–µ—Ç—Å—è –ø–æ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—É).
    WHILE @@FETCH_STATUS = 0 ‚Äî –ø–æ–∫–∞ —Å—Ç—Ä–æ–∫–∏ –µ—Å—Ç—å, –≤—ã–ø–æ–ª–Ω—è–µ–º –ª–æ–≥–∏–∫—É.
    CLOSE ‚Äî –∑–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä.
    DEALLOCATE ‚Äî –æ—Å–≤–æ–±–æ–∂–¥–∞–µ–º –ø–∞–º—è—Ç—å.
    üî∫

    üî∂ –ö–æ–º–∞–Ω–¥–∞ FETCH –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–µ—Ä–µ–º–µ—â–∞—Ç—å—Å—è –ø–æ –∫—É—Ä—Å–æ—Ä—É, –ø–µ—Ä–µ–¥–≤–∏–≥–∞—è —Ç–µ–º —Å–∞–º—ã–º —É–∫–∞–∑–∞—Ç–µ–ª—å –ø–æ —Å—Ç—Ä–æ–∫–∞–º –≤ –∫—É—Ä—Å–æ—Ä–µ:
    üîπ NEXT - –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É
    üîπ PRIOR - –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é —Å—Ç—Ä–æ–∫—É
    üîπ FIRST - –Ω–∞ –ø–µ—Ä–≤—É—é —Å—Ç—Ä–æ–∫—É 
    üîπ LAST - –Ω–∞ –ø–æ—Å–ª–µ–¥–Ω—é—é —Å—Ç—Ä–æ–∫—É
    ‚ùï —Ç–æ–ª—å–∫–æ –¥–ª—è —ç—Ç–æ–≥–æ –Ω—É–∂–Ω–æ —É–∫–∞–∑–∞—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä SCROLL, –≤–æ –≤—Ä–µ–º—è –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∫—É—Ä—Å–æ—Ä–∞ (CURSOR SCROLL FOR).


    ‚ùå –ú–∏–Ω—É—Å—ã
    üî∏ –ú–µ–¥–ª–µ–Ω–Ω—ã–µ (–ø–æ—Å—Ç—Ä–æ—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ–≥–¥–∞ —Ö—É–∂–µ –ø–∞–∫–µ—Ç–Ω–æ–π).
    üî∏ –ñ—Ä—É—Ç –ø–∞–º—è—Ç—å –∏ —Ä–µ—Å—É—Ä—Å—ã.
    üî∏ –ò—Ö –æ–±—ã—á–Ω–æ –∑–∞–º–µ–Ω—è—é—Ç –Ω–∞ JOIN, CTE, MERGE, UPDATE...FROM.
*/
-----------------------------------------------------------------------

-- 1. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö
DECLARE @ProductID INT,
		@ProductName NVARCHAR(100),
		@Price MONEY

-- 2. –û–±—ä—è–≤–ª–µ–Ω–∏–µ –∫—É—Ä—Å–æ—Ä–∞
DECLARE TestCursor CURSOR FOR
	SELECT ProductID, ProductName, Price
	FROM Products
	WHERE CategoryID = 1

-- 3. –û—Ç–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
OPEN TestCursor

-- 4. –°—á–∏—Ç—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ –ø–µ—Ä–≤–æ–π —Å—Ç—Ä–æ–∫–∏ –≤ –∫—É—Ä—Å–æ—Ä–µ
-- –∏ –∑–∞–ø–∏—Å—ã–≤–∞–µ–º –∏—Ö –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
FETCH NEXT FROM TestCursor INTO @ProductID, @ProductName, @Price

-- –ó–∞–ø—É—Å–∫–∞–µ–º —Ü–∏–∫–ª, –≤—ã–π–¥–µ–º –∏–∑ –Ω–µ–≥–æ, –∫–æ–≥–¥–∞ –∑–∞–∫–æ–Ω—á–∞—Ç—Å—è —Å—Ç—Ä–æ–∫–∏ –≤ –∫—É—Ä—Å–æ—Ä–µ
WHILE @@FETCH_STATUS = 0
BEGIN
    -- –ù–∞ –∫–∞–∂–¥—É—é –∏—Ç–µ—Ä–∞—Ü–∏—é —Ü–∏–∫–ª–∞ –≤—ã–ø–æ–ª–Ω—è–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –Ω–∞–º SQL –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏
    -- –î–ª—è –ø—Ä–∏–º–µ—Ä–∞ –∏–∑–º–µ–Ω—è–µ–º —Ü–µ–Ω—É –ø–æ —É—Å–ª–æ–≤–∏—é
	IF @Price < 100
		UPDATE Products SET Price = Price + 10
		WHERE ProductID = @ProductID

    -- –°—á–∏—Ç—ã–≤–∞–µ–º —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É –∫—É—Ä—Å–æ—Ä–∞
	FETCH NEXT FROM TestCursor INTO @ProductID, @ProductName, @Price
END

-- 5. –ó–∞–∫—Ä—ã–≤–∞–µ–º –∫—É—Ä—Å–æ—Ä
CLOSE TestCursor

-- –û—Å–≤–æ–±–æ–∂–¥–∞–µ–º —Ä–µ—Å—É—Ä—Å—ã
DEALLOCATE TestCursor


-----------------------------------------------------
-- –ü—Ä–∏–º–µ—Ä —Å SCROLL (PRIOR, FIRST, LAST)

INSERT INTO People (Name)
VALUES (N'–ò–≤–∞–Ω'), (N'–ê–Ω–Ω–∞'), (N'–ü—ë—Ç—Ä'), (N'–û–ª—å–≥–∞');

-- –ò—Å–ø–æ–ª—å–∑—É–µ–º –∫—É—Ä—Å–æ—Ä
DECLARE @ID INT, @Name NVARCHAR(50);

DECLARE PeopleCursor CURSOR SCROLL FOR
    SELECT ID, Name FROM People ORDER BY ID;

OPEN PeopleCursor;

-- –ü–µ—Ä–≤–∞—è —Å—Ç—Ä–æ–∫–∞
FETCH FIRST FROM PeopleCursor INTO @ID, @Name;
PRINT 'FIRST: ' + CAST(@ID AS NVARCHAR) + ' - ' + @Name;

-- –ü–æ—Å–ª–µ–¥–Ω—è—è —Å—Ç—Ä–æ–∫–∞
FETCH LAST FROM PeopleCursor INTO @ID, @Name;
PRINT 'LAST: ' + CAST(@ID AS NVARCHAR) + ' - ' + @Name;

-- –ü—Ä–µ–¥—ã–¥—É—â–∞—è —Å—Ç—Ä–æ–∫–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π ‚Äî LAST)
FETCH PRIOR FROM PeopleCursor INTO @ID, @Name;
PRINT 'PRIOR (–ø–µ—Ä–µ–¥ –ø–æ—Å–ª–µ–¥–Ω–∏–º): ' + CAST(@ID AS NVARCHAR) + ' - ' + @Name;

-- –°–ª–µ–¥—É—é—â–∞—è —Å—Ç—Ä–æ–∫–∞ (–æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ —Ç–µ–∫—É—â–µ–π)
FETCH NEXT FROM PeopleCursor INTO @ID, @Name;
PRINT 'NEXT: ' + CAST(@ID AS NVARCHAR) + ' - ' + @Name;

CLOSE PeopleCursor;
DEALLOCATE PeopleCursor;

---------
/*
    OUTPUT:

    FIRST ‚Üí –ò–≤–∞–Ω
    LAST ‚Üí –û–ª—å–≥–∞
    PRIOR ‚Üí –ü—ë—Ç—Ä (—Å—Ç—Ä–æ–∫–∞ –ø–µ—Ä–µ–¥ –û–ª—å–≥–æ–π)
    NEXT ‚Üí —Å–Ω–æ–≤–∞ –û–ª—å–≥–∞ (—Ç.–∫. –º—ã –≤–µ—Ä–Ω—É–ª–∏—Å—å –≤–ø–µ—Ä—ë–¥)
*/